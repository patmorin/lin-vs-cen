\documentclass{patmorin}
\listfiles
\usepackage{pat}
\usepackage{paralist}
\usepackage{dsfont}  % for \mathds{A}
\usepackage[utf8x]{inputenc}
\usepackage{skull}
\usepackage{paralist}
\usepackage{graphicx}
\usepackage[noend]{algorithmic}
\usepackage{bbm}  % needed for \mathbbm{1}

\usepackage[normalem]{ulem}
\usepackage{cancel}
%\usepackage{enumitem}

\usepackage{todonotes}

% etoolbox allows for robust commands that don't need \protect, e.g.
% \newrobustcmd{\onesub}{\mathord{\includegraphics{figs/one-sub}}}
% \subsection{Approximate Voronoi Diagrams in $G^{\onesub}_k$}
\usepackage{etoolbox}

\usepackage[longnamesfirst,numbers,sort&compress]{natbib}

\usepackage[mathlines]{lineno}
\setlength{\linenumbersep}{2em}
% \linenumbers
% \rightlinenumbers
% \linenumbers
\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
 \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
 \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
 \renewenvironment{#1}%
    {\linenomath\csname old#1\endcsname}%
    {\csname oldend#1\endcsname\endlinenomath}}%
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
 \patchAmsMathEnvironmentForLineno{#1}%
 \patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
\patchBothAmsMathEnvironmentsForLineno{equation}%
\patchBothAmsMathEnvironmentsForLineno{align}%
\patchBothAmsMathEnvironmentsForLineno{flalign}%
\patchBothAmsMathEnvironmentsForLineno{alignat}%
\patchBothAmsMathEnvironmentsForLineno{gather}%
\patchBothAmsMathEnvironmentsForLineno{multline}%
}


% Taken from
% https://tex.stackexchange.com/questions/42726/align-but-show-one-equation-number-at-the-end
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\newcommand{\defin}[1]{\emph{\color{brown}#1}}
\setlength{\parskip}{1ex}

% Document-specific commands and math operators
\DeclareMathOperator{\tw}{tw}
\DeclareMathOperator{\td}{td}
\DeclareMathOperator{\chicen}{\chi_{\mathrm{cen}}}
\DeclareMathOperator{\chilin}{\chi_{\mathrm{lin}}}
\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\vor}{Vor}

\DeclareMathOperator{\binomial}{binomial}

\newrobustcmd{\onesub}{\mathord{\includegraphics{figs/one-sub}}}
\newrobustcmd{\leftup}{\mathord{\includegraphics{figs/left-up}}}

\title{\MakeUppercase{Linear versus centred Colouring Numbers}\thanks{This research was partly funded by NSERC.}}
\author{Prosenjit~Bose, Vida~Dujmović, Hussein~Houdrouge, Mehrnoosh~Javarsineh, and Pat~Morin}

\DeclareMathOperator{\VE}{\mathit{VE}}

\date{}


\begin{document}

\maketitle
\renewcommand{\E}{\mathbb{E}}
\renewcommand{\Pr}{\mathbb{P}}

\begin{abstract}
    These are some notes on the relationships betwee linear colouring numbers and centred colouring numbers.
\end{abstract}

\section{Introduction}

Let $G$ be a simple undirected graph.  A \emph{$k$-colouring} of $G$ is any function $\varphi:V(G)\to S$ where $S$ is a set of size $k$.  A vertex $v$ of $G$ is a \emph{centre} of $G$ with respect to $\varphi$ if $\varphi(v)\not\in\{\varphi(w):w\in V(G)\setminus\{v\}\}$, i.e., $v$ is the unique vertex of $G$ having colour $\varphi(v)$.  A colouring $\varphi$ of $G$ is \emph{centred} if every connected subgraph of $G$ has a centre with respect to $\varphi$. A colouring $\varphi$ of $G$ is \emph{linear} if every simple path in $G$ has a centre with respect to $\varphi$.

The \emph{centred chromatic number} $\chicen(G)$ of $G$ is the minimum integer $c$ such that $G$ has a centred $c$-colouring.  We note that an easy argument shows that centred chromatic number and treedepth are equivalent, i.e., $\td(G)=\chicen(G)$ for every graph $G$. The \emph{linear chromatic number} of $G$ is the minimum integer $\ell$ such that $G$ has a linear $\ell$-colouring.  Since every path in $G$ is a connected subgraph of $G$, every centred colouring of $G$ is also a linear colouring of $G$, so $\chilin(G)\le\chicen(G)$.

The question of upper bounding $\chicen(G)$ by some function of $\chilin(G)$ was considered by \citet[Theorem~1]{kun.obrien.ea:polynomial} who showed the following result:

\begin{thm}[\citet{kun.obrien.ea:polynomial}]\label{kun_obrien_general}
  For any graph $G$, $\chicen(G)\le \chilin^{19}(G)\cdot\log^{O(1)}(\chilin(G))$.
\end{thm}

Their proof of \cref{kun_obrien_general} has three steps:
\begin{enumerate}
  \item A theorem of \citet{kawarabayashi.rossman:polynomial} shows that, if $\chicen(G)\ge k^{19}\log^{O(1)} k$ then $G$ contains a subcubic tree of treedepth $\Omega(k)$, or $\tw(G)\in\Omega(k^{18})$.  In the former case, an asymptotically optimal result of \citet{kun.obrien.ea:polynomial} on subcubic trees completes the proof, so we are left with the case where $\tw(G)\in\Omega(k^{18})$.
  \item The current-best version of the Excluded Grid Theorem due to \citet{chuzhoy:improved} shows that, if $\tw(G)\ge k^{18}$, then $G$ contains an $\Omega(k^2\times k^2)$ grid minor.\todo{Update reference}
  \item A technical lemma \cite[Lemma~5]{kun.obrien.ea:polynomial} shows that, if $G$ contains a $k^2\times k^2$ grid minor, then $\chilin(G)\in\Omega(k)$.\todo{Update reference}
\end{enumerate}

In the current work, we improve the technical lemma in Point~3 to show that a $k\times k$ grid minor is sufficient to guarantee that $\chilin(G)\in\Omega(k)$. This improves the exponent in \cref{kun_obrien_general} from $19$ to $10$.

This gives the following improvement to \cref{kun_obrien_general}
\begin{thm}\label{kun_obrien_general2}
  For any graph $G$, $\chicen(G)\in O(\chilin^{10}(G))$.
\end{thm}


In addition to the improvement to \cref{kun_obrien_general}, this results in considerably better bounds for some specific graph classes.  For example, the Excluded Grid Theorem for planar graphs asserts that any planar graph of treewidth $k$ contains a $\Omega(k)\times \Omega(k)$ grid minor.  Using this result instead of Point~2, above, implies that for any planar graph $G$, $\chicen(G)\in O(\chilin^2(G))$.

Finally, \citet{kun.obrien.ea:polynomial} boldly conjecture that, for any graph $G$, $\chicen(G)\le 2\chilin(G)$.  However, before the current work, the only class of graphs for which centred chromatic number was known to be bounded by a linear function of linear chromatic number was bounded degree trees.  The current result adds further evidence for this conjecture by establishing that, when $G$ is a $k\times k$ grid (or even a pseudogrid), then $\chicen(G)\in\Theta(\chilin(G))$.

\section{Preliminaries}


In this paper, all graphs are simple and undirected. For a graph $G$, $V(G)$ denotes the vertex set of $G$, $E(G)$ denotes the edge set of $G$ and $\VE(G):=V(G)\cup E(G)$.

We make use of the following (polygamous) generalisation of Hall's Marriage Theorem, which follows from Hall's Marriage Theorem by replacing each vertex $x\in X$ with a $d$-tuple $x_1,\ldots,x_d$ each having the same neighbours as $x$.

\begin{cor}\label{d_hall}
  Let $d\ge 1$ be an integer and let $G$ be a bipartite graph with parts $X$ and $Y$ such that, for any $A\subseteq X$, $|N_G(A)|\ge d|A|$.  Then $G$ contains a subgraph $M$ such that $\deg_M(x)=d$ for each $x\in X$ and $\deg_M(y)\le 1$ for each $y\in Y$.
\end{cor}

We will also make use of the following weighted version of the Lovász Local Lemma:

\begin{lem}\label{weighted_lovasz}
  Let $E:=\{E_1,\ldots,E_n\}$ be a set of events in some probability space $(\Omega,\Pr)$.  For each $i\in\{1,\ldots,n\}$, let $\Gamma_i\subseteq E$ be such that the event $E_i$ is mutually independent of $E\setminus \Gamma_i$,\footnote{An event $A$ is mutually independent of a set $\{B_1,\ldots,B_r\}$ of events if, for any disjoint sets $I,J\subseteq\{1,\ldots,r\}$, $\Pr(A\cap\bigcap_{i\in I} B_i\cap\bigcap_{j\in J} \overline{B}_j=\Pr(A)\Pr(\bigcap_{i\in I} B_i\cap\bigcap_{j\in J} \overline{B}_j)$.} and let $w:E\to(0,1)$ be such that
  \[
      \Pr(E_i) \le w(E_i)\cdot\prod_{E_j\in\Gamma_i}(1-w(E_j))  \enspace .
  \]
  Then $\Pr(\overline{E_1}\cap\cdots\cap\overline{E_n}) > 0$.
\end{lem}

% \begin{proof}
%   \todo[inline]{Surely this is known}
% \end{proof}
%
%
% \todo[inline]{Surely this next lemma is well-known?}
% We make use of the following generalization of Hall's Marriage Theorem \cite{hall:on}:
% \begin{lem}\label{hall_vees}
%   Let $G$ be a bipartite graph with vertex parts $A$ and $B$ and having the property that, for any $A_0\subseteq A$, $|N_G(W)|\ge 2|A_0|$.  Then $G$ contains a subgraph $\Lambda$ in which each vertex of $A$ has degree exactly two and each vertex of $B$ has degree at most one.
% \end{lem}
%
% \begin{proof}
%   Let $\Lambda$ be a subgraph of $G$ in which each vertex of $A$ has degree at most two, each vertex of $B$ has degree at most one, and that maximizes $\deg_\Lambda(A)$.  If $\deg_{\Lambda}(A) = 2|\Lambda|$ then there is nothing to prove. Assume therefore, for the sake of contradiction,  that there exists $v_0\in A$ with $\deg_\Lambda(v_0) < 2$.
%
%   We say that a path $v_0,\ldots,v_m$ in $G$ is \emph{$\Lambda$-aternating} if $v_iv_{i+1}\in E(\Lambda)$ for all odd $i\in\{0,\ldots,m-1\}$ and $v_iv_{i+1}\not\in E(\Lambda)$ for all even $i\in\{0,\ldots,m\}$.  Observe that any such path has even length so that it ends at a vertex $v_m\in A$.  Otherwise, replacing the edges $\lfloor m/2\rfloor$ edges $\{v_1v_2,v_3v_4,\ldots,v_{m-2}v_{m-1}\}\in E(\Lambda)$ with the $\lceil m/2\rceil$ edges $\{v_0v_1,v_2v_3,\ldots,v_{m-1}v_m\}$ does not change $\deg_\Lambda(v)$ for any $v\in A_0\setminus\{v_0\}$ but does increase  $\deg_\Lambda(v_0)$, contradicting the assumption that $\Lambda$ maximizes $\deg_\Lambda(A)$.
%
%   Let $A_0\subseteq A$ and $B_0\subseteq B$ be the subsets of $A$ and $B$, respectively, that can be reached from $v_0$ by $\Lambda$-alternating paths.
%   Observe that, for any $x\in B_0$,  there is exactly one edge $vx$ of $\Lambda$ incident on $x$ and the other endpoint $v$ of this edge is in $A_0$.  Let $a$ be the number of edges of $\Lambda$ having one endpoint $A_0$ and one endpoint in $B_0$, so that $a=\deg_\Lambda(B_0)=|B_0|$.  Let $b$ be the number of edges of $\Lambda$ having one endpoint in $A_0$ and one endpoint in $B\setminus B_0$, so that $\deg_\Lambda(A_0)=a+b = |B_0|+b$.    Since $\deg_{\Lambda}(v) \le 2$ for each $v\in A_0$ and $\deg_\Lambda(v_0)<2$, $\deg_\Lambda(A_0)<2|A_0|$.  This yields the desired contradiction, since $|N_\Lambda(A_0)| \le \deg_\Lambda(A_0) = |B_0|+b = \deg_\Lambda(A_0)< 2|A_0|$.greater than
% \end{proof}
%
% \begin{rem}
%   The constant $2$ that appears twice in \cref{hall_vees} can be replaced with any positive integer $c$.
% \end{rem}


\section{The Linear Colouring Number of Pseudogrids}

% Refer to \cref{grid_figure}.
For positive integers $a$ and $b$, the \emph{$a\times b$ grid} $G_{a\times b}$ is the graph with vertex set $V(G_{a\times b}):=\{1,\ldots,a\}\times\{1,\ldots,b\}$ and that contain an edge with endpoints $(v,w)$ and $(x,y)$ if and only if $|v-x|+|w-y|=1$.  For each $i\in\{1,\ldots,a\}$, the \emph{$i$th column} of $G_{a\times b}$ is the vertex set $\{(i,1),\ldots,(i,b)\}$ and, for each $j\in\{1,\ldots,b\}$, the $j$th row is the vertex set $\{(1,j),\ldots,(a,j)\}$.

In this work, we need to work with pseudogrids.  An \defin{$a\times b$-pseudogrid} is any graph that can be obtained from $G_{a\times b}$ in the following way:
\begin{compactitem}
  \item Replace each edge $vw$ of $G_{a\times b}$ with a path $\overline{P}_{vw}$ whose endpoints are $v$ and $w$.  (In other words, $\overline{P}_{vw}$ is a path obtained by subdividing the edge $vw$ zero or more times.)
  \item Replace each degree-$4$ vertex $(x,y)$ of $G_{a\times b}$ with a path $P_v$. If $P_v$ has only one vertex then the unique vertex of $P_v$ is adjacent to each of $(x\pm 1,y\pm 1)$ and this has effect.  Otherwise, $P_v$ has two endpoints $p$ and $q$, each of which is adjacent to two vertices among $(x\pm 1,y\pm 1)$.  It is useful to consider three possible cases:
  \begin{compactenum}[(Q1)]
    \item \label{q_i} $p$ is adjacent to $\{(x-1,y), (x,y-1)\}$ and $q$ is adjacent to $(x+1,y),(x,y+1)$;
    \item \label{q_ii} $p$ is adjacent to $\{(x,y+1), (x-1,y)\}$ and $q$ is adjacent to $(x,y-1),(x+1,y)$; or
    \item \label{q_iii} $p$ is adjacent to $\{(x-1,y),(x+1,y)\}$ and $q$ is adjacent to $\{(x,y-1),(x,y+1)\}$.
  \end{compactenum}
\end{compactitem}

Let $G$ be an $a\times b$ pseudogrid.  For an edge $vw$ of $G_{a\times b}$, we let $P_{vw}:=\overline{P}_{vw}-\{v,w\}$ denote the (possibly empty) subpath containing the internal vertices of $\overline{P}_{vw}$.  For each vertex $v$ of $G_{a\times b}$ of degree less than $4$ we define $P_{v}$ to be the $1$-vertex path that contains only $v$.  In this way, $\mathcal{P}:=\{V(P_\mu):\mu\in \VE(G_{a\times b})\}$ is a partition of $V(G)$ into induced paths and the quotient graph $G/\mathcal{P}$ is isomorphic to $G_{a\times b}$.  We call $\mathcal{P}$ a \defin{grid-partition} of $G$.
% and we denote it by $(P_\mu:\mu\in \VE(G_{a\times b}))$.
% This defines a mapping $\delta:V(G)\to V(G_{a\times b})\cup E(G_{a\times b})$ where $u\in V(P_{\delta(u)})$ for each $u\in v(G)$.

% Then each vertex $u$ of $G$ naturally corresponds to an edge or vertex $u'$ of $G_{a\times b}$:  If $u$ is a vertex of $P_{vw}$ then $u'=vw$; if $u$ a vertex of $P_v$ then $u'=v$; and otherwise $u'=u$.  This latter case occurs precisely when $u'$ is one of the boundary vertices of $G_{a\times b}$.

Each row $R':=v_1,\ldots,v_a$ of $G_{a\times b}$ corresponds naturally to a path $R$ of $G$. The path $R$ contains $V(\overline{P}_{v_iv_{i+1}})$ for each $i\in\{1,\ldots,a-1\}$.  However, for $i\in\{2,\ldots,a-1\}$ $R$ may or may not contain $V(P_{v_i})$.  In particular, if $P_{v_i}$ was created using (Q\ref{q_iii}) then $R$ does not contain any internal vertices in $P_{v_i}$. Similarly, a column $C':=v_1,\ldots,v_b$ of $G_{a\times b}$ corresponds to a path that contains $V(\overline{P}_{v_jv_{j+1}})$ for each $j\in\{1,\ldots,b-1\}$. This correspondence allows us to talk about the rows and columns of $G$, which we will do next.

As part of our proof, we use the operation of \defin{deleting} a row (or column) $R$ of $G$, which works as follows:  We remove all edges of $R$ from $G$ and eliminate any isolated vertices.  If this produces vertices of degree $1$ (which happens when $R$ is the first or last row of $G$ or when $R=v_1,\ldots,v_a$ does not contains $P_{v_i}$ for some $i\in\{1,\ldots,r\}$) then we repeatedly remove degree-$1$ vertices until none remain.  If $G$ is an $a\times b$ pseudogrid and we delete some row $R$, then the resulting graph is an $a\times (b-1)$ pseudogrid.  Similarly, if we delete column $C$ of $G$, then the resulting graph is a $(a-1)\times b$ pseudogrid.

\subsection{Proof Outline}

If some graph contains a $k\times k$ grid minor then it contains a $k\times k$ pseudogrid as a subgraph.  Therefore to prove \cref{kun_obrien_general2}, it suffices to prove:

\begin{lem}\label{pseudogrid_lower_bound}
  For any $k\times k$ pseudogrid $G$, $\chilin(G)\in\Omega(k)$.
\end{lem}

We do this by showing that for sufficiently small $\epsilon >0$,  any $\epsilon k$-colouring of any $k\times k$ pseudogrid $G$ contains an uncentred path $P$. We will do this in several steps (see \cref{outline}):

\begin{figure}
  \begin{center}
    \begin{tabular}{ccc}
      \includegraphics{figs/outline-2} &
      \includegraphics{figs/outline-3} &
      \includegraphics{figs/outline-4} \\
      $S_1$ & $S_1\cup S_2$ & $P$
    \end{tabular}
  \end{center}
  \caption{Constructing the sets $S_1$ and $S_2$ and the path $P$.}
  \label{outline}
\end{figure}
\begin{compactenum}

  \item We first delete rows and columns from $G$ so that each colour that appears in $G$ appears at least $C$ times, for some large constant $C$.  From this point on the goal is to construct $P$ so that it contains each colour at least twice.

  \item We do our best to find a set $S_1$ of vertices in $G$ that contains two vertices of each colour and that is `well-separated' in the sense that the corresponding set of vertices/edges in $G_{k\times k}$ have a minimum distance between them.  In \cref{outline} this minimum distance corresponds to the fact that the box drawn centered at each vertex in $S_1$ contains no other vertices of $S_1$.
  % This makes it easy to find a single path in $G$ that contains each of these vertices.
  Unfortunately, this process will fail for some subset of the colours that appear in $G$.

  \item For these failed colours, we use a variant of Hall's Theorem to match each failed colour $\alpha$ with two vertices in $S_1$ that each contain a vertex of colour $\alpha$ nearby.  In this matching, no vertex of $S_1$ is matched with more than one failed colour.  From this we identify a set $S_2$ that contains two vertices of each of the missing colours and such that no vertex of $S_2$ is close to any other vertex of $S_2$.

  \item We construct a path $P$ that contains each vertex in $S_1\cup S_2$.  This is possible (easy, even) because each vertex in $S_1$ is `close to' at most one vertex of $S_2$ and vice-versa.
\end{compactenum}

The most challenging aspect of this proof is the construction of $S_2$, which requires the use of the Local Lemma to ensure that no vertex chosen to take part in $S_2$ is close to any other vertex in $S_2$.  The difficulty is illustrated in \cref{outline} by the cluster of three points of $S_1$ in the top right corner.  These three points of $S_1$ are well-separated, but choosing one point from each of the three boxes to take part in $S_2$ could result in three points of $S_2$ being very close to each other.  The local lemma is used to show that, in situations like this, we can still obtain two vertices of $S_2$ from each missing colour class while avoiding taking two vertices of $S_2$ from these three boxes.

We now proceed with the various steps in the proof.


\subsection{Pseudogrids with Exclusively Frequent Colours}

For convenience, let $G_k:=G_{k\times k}$.
Let $G$ be a $k\times k$ pseudogrid with grid partition $\mathcal{P}:=(P_\mu:\mu\in\VE(G_{k}))$ and let $\varphi:V(G)\to\{1,\ldots,c\}$ be a vertex colouring of $G$.  The partition $\mathcal{P}$ associates each vertex of $G$ with an edge or vertex $\mu$ of $G_k$, so $\varphi$ associates a colour set with each object in $\VE(G_k)$, as follows.  For each $\mu\in\VE(G_{k})$, we let $\varphi_{\mathcal{P}}(\mu):=\{\varphi(v):v\in V(P_\mu)\}$.  For each colour $\alpha\in\{1,\ldots,c\}$, define $\varphi^{-1}(\alpha):=\{v\in V(G):\varphi(v)=\alpha\}$ and define $\varphi_\mathcal{P}^{-1}(\alpha):=\{\mu\in \VE(G_{k\times k}):\alpha\in\varphi_\mathcal{P}(\mu)\}$.  For any colour set $A\subseteq\{1,\ldots,c\}$ define $\varphi^{-1}(A):=\bigcup_{\alpha\in A}\varphi^{-1}(\alpha)$ and $\varphi_\mathcal{P}^{-1}(A):=\bigcup_{\alpha\in A}\varphi_{\mathcal{P}}^{-1}(\alpha)$.  (Throughout this section, we will use the idiom $\varphi(V(G))$ to denote the set of all colours used by $\varphi$ to colour the vertices of $G$.)

% We extend $\varphi$ to a partial colouring $\phi:V(G_{k\times k})\cup E(G_{k\times k})\to\{1,\ldots,c,\perp\}$ of the edges and vertices of $G_{k\times k}$ as follows:  For each vertex $v$ of $G_{k\times k}$, define $\phi(v)$ be an arbitrary colour in $\{\varphi(x):x\in V(P_v)\}$.  For each edge $vw$ of $G_{k\times k}$, there are two possibilities:
% If $P_{vw}$ is empty then $\phi(vw):=\perp$, otherwise $\phi(vw)$ is an arbitrary colour in $\{\varphi(x):x\in V(P_{vw})\}$.

\begin{lem}\label{only_frequent}
  Let $d\ge 1$ and $k\ge 1$ be integers, let $G$ be a $k\times k$ pseudogrid and let $\varphi$ be a vertex colouring of $G$ that uses $|\varphi(V(G))|\le k/d$ colours.
  Then $G$ contains a $k'\times k'$ pseudogrid $G'$ with $k'\ge k - d|\varphi(V(G))|$ that has a grid-partition $\mathcal{P}':=\{V(P'_\mu):\mu\in \VE(G_{k})\}$ such that
  for any $A\subseteq \varphi(V(G'))$, $|\varphi_{\mathcal{P}'}^{-1}(A)| \ge d|A|$.
\end{lem}

\begin{proof}
  The proof is by induction on $|\varphi(V(G))|$, the number of colours used by the colouring $\varphi$.  If there exists no $A\subseteq \varphi(V(G))$ with $\varphi_{\mathcal{P}}^{-1}(A) < d|A|$ then taking $G':=G$ and $\mathcal{P}':=\mathcal{P}$ satisfies the requirements of the lemma. Otherwise, we will remove a set $R$ of rows and a set $C$ of columns from $G$ with $|R|=|C|\le d|A|$ to eliminate all vertices with colours in $A$, as follows:
  \begin{compactitem}
    \item For each $v:=(i,j)\in V(G_{k})$ with $A\cap\varphi_\mathcal{P}(v)\neq\emptyset$, we include row $j$ in $R$ and column $i$ in $C$.
    \item For each horizontal edge $vw\in E(G_{k\times k})$ with $A\cap\varphi_\mathcal{P}(vw)\neq\emptyset$, we include the row of $G$ that contains $P_{vw}$ in $R$.
    \item For each vertical edge $vw\in E(G_{k\times k})$ with $A\cap\varphi_\mathcal{P}(vw)\neq\emptyset$, we include the row of $G$ that contains $P_{vw}$ in $R$.\todo{Define horizontal and vertical edges of $G$.}
    \item Finally, we add arbitrary rows to $R$ or columns to $C$ to ensure that $|R|=|C|$.
  \end{compactitem}
  At this point $|R|=|C|\le d|A|$ and we remove all rows in $R$ and all columns in $C$ from $G$ to obtain a $k_0\times k_0$ pseudogrid $G_0$ with $k_0\ge k-d|A|$ and such that $\varphi(V(G_0))\cap A=\emptyset$.  In particular, $|\varphi(V(G_0))|\le |\varphi(V(G))|-|A|$.

  Now apply induction on $G_0$ to get a $k'\times k'$ pseudogrid with
  \[  k'\ge k_0-d|\varphi(V(G_0))|  \ge k-d|A|-d|\varphi(V(G_0))|\ge k - d|\varphi(V(G))|
  \]
  that satisfies the conditions of the lemma.
\end{proof}

Having each vertex or edge $\mu$ of $G_k$ associated with a set $\varphi_\mathcal{P}(\mu)$ of colours rather than a single colour will be problematic for what we want to to do next.  The following lemma allows us to choose one representative colour $\phi(\mu)$ from $\varphi_{\mathcal{P}}(\mu)$ for each $\mu\in \VE(G_k)$ while still ensuring that each colour appears frequently.

\begin{lem}\label{one_colour_per_object}
  Let $d>1$ be an integer, let $G$ be a $k\times k$ pseudogrid with grid-partition $\mathcal{P}$, and let $\varphi:V(G)\to\{1,\ldots,c\}$ be a vertex colouring of $G$ such that, for any $A\subseteq\varphi(V(G))$, $|\varphi_{\mathcal{P}'}^{-1}(A)| \ge d\cdot|A|$. Then there exists a colouring $\phi:\VE(G_{k})\to\{1,\ldots,c,\perp\}$ with the following properties:
  \begin{compactenum}[(i)]
    \item For each $\mu\in\VE(G_{k})$, $\phi(\mu)=\perp$ or $\phi(\mu)\in\varphi(\mu)$.
    \item For each $\alpha\in\varphi(V(G))$, $|\{\mu\in\VE(G_{k}):\phi(\mu)=\alpha\}|\ge d$.
  \end{compactenum}
\end{lem}

\begin{proof}
  Consider the bipartite graph $H$ with parts $X:=\{1,\ldots,c\}$ and $Y:=\VE(G_k)$ and edge set
  \[
    E(H) := \{ (\alpha,\mu)\in X\times Y: \alpha\in\varphi_\mathcal{P}(\mu) \}
  \]
  By \cref{d_hall}, $H$ contains a subgraph $M$ with $\deg_M(x)=d$ for each $\alpha\in X$ and $\deg_M(y)\le 1$ for each $\mu\in Y$.  For each edge $\alpha\mu$ in $M$, set $\phi(\mu):=\alpha$.  This defines $\phi(\mu)$ for any $\mu\in Y$ with $\deg_M(\mu)=1$.  For each $\mu\in Y$ with $\deg_M(\mu)=0$ set $\phi(\mu):=\perp$.
\end{proof}

\subsection{Finding Paths Through Well-Separated Pairs}

Next we show that, given a sufficiently ``well-separated'' set $S$ of pairs of vertices in $G$, we can always find a path in $G$ that contains every vertex in $S$. For this, we need some definitions of boxes in $G$ and in $G_k$.

The \defin{$r$-box} centred at a vertex $v:=(i,j)$ of $G_{k}$ is defined as
\[
  B_r(v) := \{i-r,\ldots,i+r\}\times\{j-r,\ldots,j+r\} \cap V(G_{k}) \enspace .
\]
The \defin{$r$-box} centred at an edge $vw$ of $G_{k}$ is $B_r(vw):=B_r(v)\cup B_r(w)$.
% Observe that, for any $\mu\in V(G_{k})\cup E(G_{a\times b})$,  $v\in B_r(u)$ if and only if $u\in B_r(v)$.
Any $r$-box $B_r(\mu)$ defines an induced subgraph that we denote by $G_r(\mu):=G_{k}[B_r(\mu)]$.  We extend these definitions to vertices of an $k\times k$ pseudogrid $G$ with grid-partition $\mathcal{P}:=\{V(P_\mu):\mu\in\VE(G_k)\}$ as follows. For any $\mu\in V(G_k)$, define
\[
   \tilde{B}_r(\mu) := \bigcup_{\nu\in \VE(G_r(\mu))} V(P_\nu)
\]
and, for any $v\in V(G)$, let $\tilde{B}_r(v):=\tilde{B}_r(\mu_v)$
where $\mu_v$ denotes the unique element in $\VE(G_k)$ such that $v\in P_{\mu_v}$.\footnote{Technically, the notation for $\tilde{B}_r(v)$ should include the partition $\mathcal{P}$, but we omit this since there will never any ambiguity as to which partition is being used.}
% For any $v\in V(G)$, define $\tilde{G}_r(v):=G[\tilde{B}_r(v)]$.

\begin{lem}\label{pick_up_two}
  Let $v$ be any vertex of $G$, let $w$ be any vertex of $\tilde{G}_r(v)$, let $s$ be any vertex in the leftmost column of $\tilde{G}_r(v)$ and let $t$ be any vertex in the rightmost column of $\tilde{G}_r(v)$.  Then there exists an $st$-path\todo{define $st$-path} in $G_r(v)$ that contains $v$ and $w$.
\end{lem}

\begin{proof}
  Let $i_s \le i_v \le i_w \le i_t$ be the columns of $\tilde{G}_r(v)$ that contain $s$, $v$, $w$, and $t$, respectively.  Note that the assumption that $i_v \le i_w$ is without loss of generality and that $i_s \le i_t - r -1$.\todo{finish up}
\end{proof}

\begin{lem}\label{pick_up_everything}
  Let $r$ be an integer and let $S\subseteq V(G)$ be such that $|\tilde{B}_{r}(v)\cap S|=|\tilde{B}_{2r}\cap S|\le 2$ for each $v\in S$.  Then $G$ contains a path that contains every vertex in $S$. \todo{Set specific values for $r$}
\end{lem}

\begin{proof}[Proof sketch]
  Choose $S'\subseteq S$ so that, if $B_r(v)\cap S=\{v,w\}$ then exactly one of $v$ or $w$ is in $S'$. Now do some scan-line thing with a distance of $2r+1$ between consecutive rows.  When this scan encounters a box $B_r(v)$ for some $v\in S'$, use \cref{pick_up_two} to detour through the box to pick up the (at most two) vertices in $B_r(v)\cap S$.
\end{proof}


Before finishing with this section we recall a fairly standard looking packing lemma.


\begin{lem}\label{packing_lemma}
  Let $Q\subseteq \VE(G_k)$ be such that $\mu_1\not\in \VE(G_r(\mu_2))$ for each distinct $\mu_1,\mu_2\in Q$.  Then, for any $\mu\in \VE(G_k)$,
  $|\{\mu_1\in Q: \mu\in \VE(G_{2r}(\mu))\}| \le 25$.
\end{lem}

\todo[inline]{Fix notation conflict:  $G_r(\mu)$ versus $G_k$?  Maybe go back to $G_{k\times k}$?}

\subsection{Finding an Uncentred Path}

Next we show how, given a colouring $\varphi$ like that guaranteed by \cref{only_frequent}, we can find a set of vertices in $G$ that contain two vertices of each colour and that is compatible with \cref{pick_up_everything}.

\begin{lem}\label{doubled_colour_set}
  For every integer $r\ge 1$ there exists an integer $d\in O(r^4)$ such that the following is true, for every integer $k\ge 1$.
  Let $G$ be a $k\times k$ pseudogrid with grid-partition $\mathcal{P}:=\{V(P_\mu):\mu\in\VE(G_k)\}$ and let $\varphi$ be a vertex colouring of $G$ with the property that, for each $A\subseteq\varphi(V(G))$, $|\varphi_{\mathcal{P}}^{-1}(A)|\ge d|A|$.
  Then there exists $S\subseteq V(G)$ such that
  \begin{compactenum}[(i)]
    \item \label{hits_both} for each $\alpha\in\varphi(V(G))$, $|\{v\in S:\varphi(v)=\alpha\}|= 2$; and
    \item \label{spread_out} $|\tilde{B}_r(v)\cap S|\le 2$ for each $v\in S$.
  \end{compactenum}
\end{lem}

\begin{proof}
  We begin by applying \cref{one_colour_per_object} to obtain the colouring $\phi$ of $\VE(G_k)$.  Observe that it is now sufficient to find a $2|\varphi(V(G))|$-object subset $Q\subseteq\VE(G_k)$ such that
  \begin{compactenum}[(i)]
    \item $|\{\mu\in Q:\phi(v)=\alpha\}|= 2$ and
    \item $|\VE(G_r(\mu))\cap Q|\le 2$ for each $\alpha\in\varphi(V(G))$ and each $\mu\in Q$.
  \end{compactenum}
  Indeed, with such a $Q$ we can obtain $S$ by taking one vertex of colour $\phi(\mu)$ from $P_\mu$ for each $\mu\in Q$.

  We construct $Q$ in two rounds.  In the first round, we start with an initially empty set $Q_1$ and repeat the following for each $\alpha\in\varphi(V(G))$:
  If there exists distinct $\mu_1,\mu_2\in\VE(G_k)$ such that
  \begin{compactenum}[(a)]
    \item $\phi(\mu_1)=\phi(\mu_2)=\alpha$; and\label{hits_both_q}
    \item for each $b\in\{1,2\}$, $\mu_b\not\in \VE(G_r(\mu_{3-b})) \cup \bigcup_{\mu\in Q_1} \VE(G_r(\mu))$.\label{spread_out_q}
  \end{compactenum}
  then we include $\mu_1$ and $\mu_2$ in $Q_1$ and declare the first round \defin{$\alpha$-successful}.  Otherwise, we declare the first round an \defin{$\alpha$-failure}.

  Let $K\subseteq\varphi(V(G))$ be the set of colours $\alpha$ for which the first round was $\alpha$-successful. At the end of this process, the set $Q_1$ certainly satisfies (\ref{spread_out}) since (\ref{spread_out_q}) implies that $\VE(G_r(\mu))\cap Q_1=\{\mu\}$ for each $\mu\in Q_1$.  However, $Q_1$ only satisfies (\ref{hits_both}) for the colours in $K$.  We now use the second round to create a set $Q_2$ to fix this.
  % Our strategy is to use \cref{d_hall} to find two matchings between the colours in $X$ and the boxes in $\{\tilde{B}_r(\mu):\mu\in Q_1\}$ that contain those colours.

  Define a bipartite graph $H$ with parts $X:=\varphi(V(G))\setminus K$ and $Y:=Q_1$.  Let $\pi:=\mu_1,\ldots,\mu_{2|K|}$ be a random permutation of the elements of $Y$.  We include an edge $\alpha\mu_i$ in $H$ if and only if
  \[
    \VE(G_r(\mu_i))\setminus\left(\bigcup_{j=1}^{i-1}\VE(G_{2r}(\mu_j))\right)
  \]
  contains some object $\nu$ of colour $\phi(\nu)=\alpha$.  Note the asymmetry here: In the first round, each element $\mu_j$ that takes part in $Q_1$ prevents elements in $\VE(G_r(\mu))$ from also being part of $Q_1$.  In the second round, $\mu_j$ defines a larger box $\VE(G_{2r}(\mu_j))$ that must be avoided when choosing an element from $\VE(G_r(\mu_i))$, for $i>j$.

  We now want to use the Local Lemma (\cref{weighted_lovasz}) to show that, with probability greater than zero, $\deg_H(\alpha)\in \Omega(d/r^2)$ for each $\alpha\in X$.
  For each $\alpha\in X$, let $\Phi_\alpha:=\{\nu\in\VE(G_k):\phi(\nu)=\alpha\}$ and recall that, since $\phi$ comes from \cref{one_colour_per_object}, $|\Phi_\alpha| \ge d$.  Furthermore all but at most one element of $\Phi_\alpha$ is contained in $\bigcup_{\mu\in Y}\VE(G_{r+1}(\mu))$ since, otherwise the first round would have succeeded for colour $\alpha$.  For each $\mu\in Y$, $|\VE(G_{r+1}(\mu))|\in O(r^2)$. Therefore, there are $\Omega(|\Phi_\alpha|/r^2)$ objects $\mu\in Y$ such that $\VE(G_{r+1}(\mu))\cap \Phi_\alpha\neq\emptyset$.

  We begin by showing that, for each $\alpha\in X$, the random variable $\deg_H(\alpha)$ dominates a $\binomial(\Omega(|\Phi_\alpha|/r^2),1/25)$ random variable, which allows us to establish en exponential inequality for $\Pr(\deg_H(\alpha) < 100r^2)$.  (We make no attempt to optimize the constants here.)  Suppose that, for some $\mu\in Y$, $B_r(\mu)\cap \Phi_\alpha$ contains at least one element $\nu$. Then, by \cref{packing_lemma}, the set
  \[
     Y_\nu := \{\tau\in Y\setminus\{\mu\}:\nu\in\VE(G_r(\tau))\}
  \]
  has size at most $25$. Observe that the edge $\alpha\mu$ will appear in $H$ if, in our random permutation $\pi$ of $Y$, $\nu$ appears before any element of $Y_\nu$.  This happens with probability exactly $1/|Y_\nu|\ge 1/25$.  This already establishes that $\E(\deg_H(\alpha)) \in \Omega(|\Phi_\alpha|/r^2)$.

  In order to obtain a sufficiently strong concentration result for $\deg_H(\alpha)$ we need to find some independence.  To do this, consider the graph $J$ with vertex set $V(J)=Y$ and which contains an edge $\mu_1\mu_2$ if $B_{2r}(\mu_1)\cap B_{2r}(\mu_2)\neq\emptyset$.  Now, consider the greedy process of repeatedly choosing a vertex $\mu$ of $J$ such that $B_r(\mu)\cap \Phi_\alpha$ contains at least one element $\nu$ and then set $J:=J-\VE(G_{10r}(\mu))$.  This process continues until no suitable vertex of $J$ remains.  Each step in this process eliminates $O(r^2)$ objects $\nu$ with $\varphi(\nu)=\alpha$,\todo{Explain better} so the number of iterations is $r\in\Omega(d/r^2)$.

  Let $\{\mu_1',\ldots,\mu_t'\}$ be the subset of $Y$ chosen by this process and let $\{\nu_1,\ldots,\nu_r\}\subseteq\Phi_\alpha$ be objects with $\nu_i\in\VE(G_r(\mu_i'))$, for each $i\in\{1,\ldots,t\}$.  The important observation now is that the sets $X_{\nu_1},\ldots,X_{\nu_t}$ are disjoint.  Therefore, if we let $U_i$ denote the event ``$\mu_i'$ apppears before any elements of $X_{\nu_i}$ in our random permutation of $Y$'' then the events $U_1,\ldots,U_k$ are mutually independent.  Indeed, each $U_i$ depends only on the relative order of $\{\mu_i'\}\cup X_{\nu_i}$ in the random permutation of $Y$.  For each $i\in\{1,\ldots,k\}$, $\Pr(U_i)\ge 1/25$.  Therefore, $\sum_{i=1}^k \mathbbm{1}_{U_i}$ dominates a $\binomial(k,1/25)$ random variable.  Therefore,
  \begin{align*}
    \Pr\left(\deg_H(\alpha)< 100r^2\right)
    & \le \Pr\left(\sum_{i=1}^t \mathbbm{1}_{U_i} < 100r^2\right) \\
    & \le \Pr(\binomial(t,1/25)\le 100r^2) \\
    & \le (2t)^{100r^2}(1/25)^{r^2}(1-1/25)^{t-100r^2} \\
    & \le \exp(100r^2\log(2t)+(t-100r^2)\log(1-1/?)) \\
    & \le \exp(-100r^2\log(2t)\log(1-1/?) + t\log(1-1/25)) \\
    & = \exp(ar^2 - bt)
  \end{align*}
  for fixed positive $a,b>0$.  Recall that we are working in the regime in  $t\in\Omega(|\Phi_\alpha|/r^2)$ and $|\Phi_\alpha|\in\Omega(d/r^2)$ so, for any fixed $C>0$, there exists $d\in\Omega(r^4)$ such that
  $\Pr(\deg_H(\alpha)< 100r^2)\le \exp(-C|\Phi_\alpha|/r^2)$.
  \todo[inline]{Work the preceding calculation out}
  We are now ready for an application of \cref{weighted_lovasz}.\todo{Continue here}  For each $\alpha\in X$, let $E_\alpha$ denote the event ``$\deg_H(\alpha)\le 100r^2$.''  For each $\alpha\in X$, define $\Gamma_\alpha$ to be the set that contains every event $E_\beta$ such that $\Phi_\alpha$ contains an element $\nu$ with $B_{10r}(\nu)\cap Z_\beta\neq\emptyset$.  The event $X_\alpha$ is mutually independent of $\{X_\beta:\beta\in X\setminus\{\alpha\}\setminus\Gamma_\alpha\}$ since, for any $E_\beta\not\in \Gamma_\alpha$ the sets $Y_\alpha:=\{\mu\in Y:B_{2r}(\mu)\cap \Phi_\alpha\neq\emptyset\}$ and $Y_\beta:=\{\mu\in Y:B_{2r}(\mu)\cap Z_\beta\neq\emptyset\}$ are disjoint and the event $E_\alpha$ is entirely determined by the relative order of $Y_\alpha$ in the permutation while $E_\beta$ is entirely determined by the relative order of $Y_\beta$.\todo{Explain better}   Finally, observe that $|\Gamma_\alpha|\le 25|\Phi_\alpha|$.

  \begin{align*}
      \Pr(E_\alpha) \le \exp(-|\Phi_\alpha|\cdot C/r^2) \enspace .
  \end{align*}

  For each $\alpha\in X$, define $w(E_\alpha)=C/2r^2$ and observe that
  \begin{align*}
    p(1-p)^{|\Gamma_\alpha|}
    & \ge  p(1-p)^{25|\Phi_\alpha|} = p\exp(|\Phi_\alpha|\cdot 25\log(1-c/2r^2))
  \end{align*}
  \todo[inline]{Sort out these calculations}

  Therefore, by \cref{weighted_lovasz}, there exists a permutation $\alpha_1,\ldots,\alpha_{2|K|}$ such that $\deg_H(\alpha)\ge 100r^2$ for each $\alpha\in X$.  On the other hand, $\deg_{H}(y)\le 8r^2$ for each $y\in Y$.  Therefore, for any $A\subseteq X$, $|N_H(A)|\ge 100|A|/8 \ge 2|A|$.  Therefore, by \cref{d_hall}, there is a subgraph $M$ of $H$ in which $\deg_M(\alpha)=2$ for each $\alpha\in X$ and $\deg_M(\mu)\le 1$ for each $\mu\in Y$. Each edge $\alpha\mu$ of $M$ corresponds to some $\nu\in X_\alpha\cap\VE(G_r(\mu))$, which we place in $Q_2$.

  Now it is straightforward to verify that $Q:=Q_1\cup Q_2$ satisifies (\ref{hits_both}).  Furthermore, for each $\mu\in Q_1$, $B_r(\mu)$ contains no object in $Q_1\setminus\{\mu\}$ and contains at most one element of $Q_2$.  Similarly, for each $\nu\in Q_2$, $B_r(\nu)$ contains no element of $Q_2\setminus\{\nu\}$ and contains at most one element of $Q_1$.  Therefore $Q$ satisfies (\ref{spread_out}).
\end{proof}


We now have all the pieces needed to complete our lower bound on the linear chromatic number of pseudogrids:

\begin{proof}[Proof of \cref{pseudogrid_lower_bound}]
  Suppose for the sake of contradiction that $G$ has a linear colouring $\varphi$ using fewer than $\epsilon k$ colours for arbitrarily small $\epsilon >0$.  Then, by \cref{only_frequent}, $G$ contains a $k'\times k'$ pseudogrid $G'$ with $k'\ge k/2$ having a grid-decomposition $\mathcal{P}':=\{P_\mu':\mu\in \VE(G_{k'})\}$ with the property that, for any $A\subseteq\varphi(V(G'))$, $|\varphi^{-1}_{\mathcal{P'}}(A)|\ge d|A|$, for any $d\le 1/2\epsilon$.  In particular, some $\epsilon \in \Omega(1/r^4)$, \cref{doubled_colour_set} implies that $G'$ contains a set $S$ of $2|\varphi(V(G')|$ vertices containing two vertices of each colour in $\varphi(V(G'))$ such that $B_r(\mu)\cap S = \{\mu\}$ for each $\mu\in S$.  By By \cref{pick_up_everything}, $G'$ contains a path $P$ that contains every vertex in $S$.  Since $P$ is contained in $G'$ $\varphi(V(P))=\varphi(V(G'))$, so $P$ is has no center under $\varphi$, contradicting the assumption that $\varphi$ is a linear colouring of $G$.
\end{proof}


\section*{Acknowledgement}

The main subject of this paper was posed as an open problem at the 9th Annual Bellairs Workshop on Geometry and Graphs (v2), which was held January 21--28, 2022 and again at the 16th Annual Workshop on Probability and Combinatorics, which was held March 25--April 1, 2022. We are grateful to the organizers and participants of both workshops for providing a stimulating research environment. Pat~Morin especially enjoyed early-morning discussions with Stefan~Langerman on the Seabourne Terrace.


\bibliographystyle{plainurlnat}
\bibliography{lin-vs-cen}




\end{document}
